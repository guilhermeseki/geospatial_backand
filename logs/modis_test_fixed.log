22:34:15.491 | INFO    | prefect - Starting temporary server on http://127.0.0.1:8917
See https://docs.prefect.io/v3/concepts/server#how-to-guides for more information on running a dedicated Prefect server.
22:34:17.691 | INFO    | Flow run 'infrared-pronghorn' - Beginning flow run 'infrared-pronghorn' for flow 'process-ndvi-data'
22:34:17.693 | INFO    | Flow run 'infrared-pronghorn' - ================================================================================
22:34:17.693 | INFO    | Flow run 'infrared-pronghorn' - NDVI DATA PROCESSING FLOW
22:34:17.694 | INFO    | Flow run 'infrared-pronghorn' - ================================================================================
22:34:17.694 | INFO    | Flow run 'infrared-pronghorn' - Period: 2024-09-01 to 2024-09-30
22:34:17.694 | INFO    | Flow run 'infrared-pronghorn' - Sources: modis
22:34:17.694 | INFO    | Flow run 'infrared-pronghorn' - ================================================================================
22:34:17.694 | INFO    | Flow run 'infrared-pronghorn' - 
Processing: MODIS
22:34:17.709 | INFO    | Task run 'check_missing_dates-cfc' - Checking for 30 dates: 2024-09-01 to 2024-09-30
22:34:18.019 | INFO    | Task run 'check_missing_dates-cfc' - Found 4 existing GeoTIFF files
22:34:18.019 | INFO    | Task run 'check_missing_dates-cfc' - Historical NetCDF does not exist yet
22:34:18.020 | INFO    | Task run 'check_missing_dates-cfc' - Missing from GeoTIFF: 30 dates
22:34:18.020 | INFO    | Task run 'check_missing_dates-cfc' - Missing from historical: 30 dates
22:34:18.020 | INFO    | Task run 'check_missing_dates-cfc' - Need to download: 30 dates
22:34:18.022 | INFO    | Task run 'check_missing_dates-cfc' - Finished in state Completed()
22:34:18.022 | INFO    | Flow run 'infrared-pronghorn' - 
Batch: 2024-09-01 to 2024-09-30
22:34:18.099 | INFO    | Task run 'download_modis_batch-6af' - ================================================================================
22:34:18.099 | INFO    | Task run 'download_modis_batch-6af' - MODIS NDVI DOWNLOAD (Microsoft Planetary Computer - FREE!)
22:34:18.100 | INFO    | Task run 'download_modis_batch-6af' - ================================================================================
22:34:21.549 | INFO    | Task run 'download_modis_batch-6af' - Found 138 MODIS composites
22:34:21.550 | INFO    | Task run 'download_modis_batch-6af' - Limited to 15 most recent composites to reduce processing time
22:34:21.551 | WARNING | Task run 'download_modis_batch-6af' - Limiting latitude pixels to 10000
22:34:21.551 | WARNING | Task run 'download_modis_batch-6af' - Limiting longitude pixels to 10000
22:34:21.552 | INFO    | Task run 'download_modis_batch-6af' - Common grid: 10000 x 10000 pixels (~250m native MODIS resolution)
22:34:21.552 | INFO    | Task run 'download_modis_batch-6af' - Grid size optimized: ~381.5 MB per composite
22:34:21.585 | INFO    | Task run 'download_modis_batch-6af' - Target MODIS bbox: W=-8338731, S=-3891827, E=-3051369, N=722768
22:34:21.585 | INFO    | Task run 'download_modis_batch-6af' - Processing composite 1/15: MOD13Q1.A2024273.h15v11.061.2024290023537
22:34:22.805 | INFO    | Task run 'download_modis_batch-6af' -   Intersection: 284482m x 1111951m (25.6% of tile)
22:34:23.616 | INFO    | Task run 'download_modis_batch-6af' -   Read 4800x1228 pixels
22:34:23.623 | INFO    | Task run 'download_modis_batch-6af' -   Masked nodata value: -3000.0
22:34:24.345 | WARNING | Task run 'download_modis_batch-6af' -   All values are NaN, skipping
22:34:24.346 | INFO    | Task run 'download_modis_batch-6af' - Processing composite 2/15: MOD13Q1.A2024273.h14v11.061.2024290023141
22:34:24.940 | INFO    | Task run 'download_modis_batch-6af' -   Intersection: 1111951m x 1111951m (100.0% of tile)
22:34:32.403 | INFO    | Task run 'download_modis_batch-6af' -   Read 4800x4800 pixels
22:34:32.430 | INFO    | Task run 'download_modis_batch-6af' -   Masked nodata value: -3000.0
22:34:33.276 | INFO    | Task run 'download_modis_batch-6af' -   âœ“ Processed successfully (0.3% valid pixels)
22:34:33.277 | INFO    | Task run 'download_modis_batch-6af' - Processing composite 3/15: MOD13Q1.A2024273.h14v10.061.2024290023336
22:34:33.891 | INFO    | Task run 'download_modis_batch-6af' -   Intersection: 1111951m x 1111951m (100.0% of tile)
22:35:35.647 | INFO    | Task run 'download_modis_batch-6af' -   Read 4800x4800 pixels
22:35:35.676 | INFO    | Task run 'download_modis_batch-6af' -   Masked nodata value: -3000.0
22:35:36.601 | INFO    | Task run 'download_modis_batch-6af' -   âœ“ Processed successfully (1.6% valid pixels)
22:35:36.602 | INFO    | Task run 'download_modis_batch-6af' - Processing composite 4/15: MOD13Q1.A2024273.h14v09.061.2024290023340
22:35:37.242 | INFO    | Task run 'download_modis_batch-6af' -   Intersection: 1111951m x 1111951m (100.0% of tile)
22:36:40.367 | INFO    | Task run 'download_modis_batch-6af' -   Read 4800x4800 pixels
22:36:40.392 | INFO    | Task run 'download_modis_batch-6af' -   Masked nodata value: -3000.0
22:36:41.270 | INFO    | Task run 'download_modis_batch-6af' -   âœ“ Processed successfully (1.7% valid pixels)
22:36:41.270 | INFO    | Task run 'download_modis_batch-6af' - Processing composite 5/15: MOD13Q1.A2024273.h13v12.061.2024290023602
22:36:41.894 | INFO    | Task run 'download_modis_batch-6af' -   Intersection: 1111951m x 555975m (50.0% of tile)
22:37:36.576 | INFO    | Task run 'download_modis_batch-6af' -   Read 2400x4800 pixels
22:37:36.676 | INFO    | Task run 'download_modis_batch-6af' -   Masked nodata value: -3000.0
22:37:37.594 | INFO    | Task run 'download_modis_batch-6af' -   âœ“ Processed successfully (1.9% valid pixels)
22:37:37.595 | INFO    | Task run 'download_modis_batch-6af' - Processing composite 6/15: MOD13Q1.A2024273.h13v11.061.2024290023353
22:37:38.212 | INFO    | Task run 'download_modis_batch-6af' -   Intersection: 1111951m x 1111951m (100.0% of tile)
22:39:16.136 | INFO    | Task run 'download_modis_batch-6af' -   Read 4800x4800 pixels
22:39:16.164 | INFO    | Task run 'download_modis_batch-6af' -   Masked nodata value: -3000.0
22:39:17.448 | INFO    | Task run 'download_modis_batch-6af' -   âœ“ Processed successfully (5.0% valid pixels)
22:39:17.448 | INFO    | Task run 'download_modis_batch-6af' - Processing composite 7/15: MOD13Q1.A2024273.h13v10.061.2024290023226
22:39:18.074 | INFO    | Task run 'download_modis_batch-6af' -   Intersection: 1111951m x 1111951m (100.0% of tile)
22:41:43.452 | INFO    | Task run 'download_modis_batch-6af' -   Read 4800x4800 pixels
22:41:43.483 | INFO    | Task run 'download_modis_batch-6af' -   Masked nodata value: -3000.0
22:41:44.823 | INFO    | Task run 'download_modis_batch-6af' -   âœ“ Processed successfully (6.0% valid pixels)
22:41:44.824 | INFO    | Task run 'download_modis_batch-6af' - Processing composite 8/15: MOD13Q1.A2024273.h13v09.061.2024290023405
22:41:45.487 | INFO    | Task run 'download_modis_batch-6af' -   Intersection: 1111951m x 1111951m (100.0% of tile)
22:43:29.039 | INFO    | Task run 'download_modis_batch-6af' -   Read 4800x4800 pixels
22:43:29.068 | INFO    | Task run 'download_modis_batch-6af' -   Masked nodata value: -3000.0
22:43:30.313 | INFO    | Task run 'download_modis_batch-6af' -   âœ“ Processed successfully (4.8% valid pixels)
22:43:30.313 | INFO    | Task run 'download_modis_batch-6af' - Processing composite 9/15: MOD13Q1.A2024273.h13v08.061.2024290023338
22:43:30.909 | INFO    | Task run 'download_modis_batch-6af' -   Intersection: 1111951m x 722768m (65.0% of tile)
22:43:31.916 | INFO    | Task run 'download_modis_batch-6af' -   Read 3120x4800 pixels
22:43:31.934 | INFO    | Task run 'download_modis_batch-6af' -   Masked nodata value: -3000.0
22:43:32.685 | INFO    | Task run 'download_modis_batch-6af' -   âœ“ Processed successfully (0.0% valid pixels)
22:43:32.686 | INFO    | Task run 'download_modis_batch-6af' - Processing composite 10/15: MOD13Q1.A2024273.h12v12.061.2024290023611
22:43:33.319 | INFO    | Task run 'download_modis_batch-6af' -   Intersection: 1111951m x 555975m (50.0% of tile)
22:45:12.862 | INFO    | Task run 'download_modis_batch-6af' -   Read 2400x4800 pixels
22:45:12.878 | INFO    | Task run 'download_modis_batch-6af' -   Masked nodata value: -3000.0
22:45:13.940 | INFO    | Task run 'download_modis_batch-6af' -   âœ“ Processed successfully (3.4% valid pixels)
22:45:13.941 | INFO    | Task run 'download_modis_batch-6af' - Processing composite 11/15: MOD13Q1.A2024273.h12v11.061.2024290023609
22:45:14.546 | INFO    | Task run 'download_modis_batch-6af' -   Intersection: 1111951m x 1111951m (100.0% of tile)
22:47:17.904 | INFO    | Task run 'download_modis_batch-6af' -   Read 4800x4800 pixels
22:47:17.932 | INFO    | Task run 'download_modis_batch-6af' -   Masked nodata value: -3000.0
22:47:19.364 | INFO    | Task run 'download_modis_batch-6af' -   âœ“ Processed successfully (6.4% valid pixels)
22:47:19.364 | INFO    | Task run 'download_modis_batch-6af' - Processing composite 12/15: MOD13Q1.A2024273.h12v10.061.2024290023239
22:47:19.973 | INFO    | Task run 'download_modis_batch-6af' -   Intersection: 1111951m x 1111951m (100.0% of tile)
22:49:15.978 | INFO    | Task run 'download_modis_batch-6af' -   Read 4800x4800 pixels
22:49:16.006 | INFO    | Task run 'download_modis_batch-6af' -   Masked nodata value: -3000.0
22:49:17.341 | INFO    | Task run 'download_modis_batch-6af' -   âœ“ Processed successfully (6.0% valid pixels)
22:49:17.342 | INFO    | Task run 'download_modis_batch-6af' - Processing composite 13/15: MOD13Q1.A2024273.h12v09.061.2024290023233
22:49:17.955 | INFO    | Task run 'download_modis_batch-6af' -   Intersection: 1111951m x 1111951m (100.0% of tile)
22:51:13.273 | INFO    | Task run 'download_modis_batch-6af' -   Read 4800x4800 pixels
22:51:13.303 | INFO    | Task run 'download_modis_batch-6af' -   Masked nodata value: -3000.0
22:51:14.601 | INFO    | Task run 'download_modis_batch-6af' -   âœ“ Processed successfully (5.8% valid pixels)
22:51:14.601 | INFO    | Task run 'download_modis_batch-6af' - Processing composite 14/15: MOD13Q1.A2024273.h12v08.061.2024290023359
22:51:15.273 | INFO    | Task run 'download_modis_batch-6af' -   Intersection: 1111951m x 722768m (65.0% of tile)
22:52:33.534 | INFO    | Task run 'download_modis_batch-6af' -   Read 3120x4800 pixels
22:52:33.551 | INFO    | Task run 'download_modis_batch-6af' -   Masked nodata value: -3000.0
22:52:34.536 | INFO    | Task run 'download_modis_batch-6af' -   âœ“ Processed successfully (3.2% valid pixels)
22:52:34.536 | INFO    | Task run 'download_modis_batch-6af' - Processing composite 15/15: MOD13Q1.A2024273.h11v12.061.2024290023738
22:52:35.155 | INFO    | Task run 'download_modis_batch-6af' -   Intersection: 1111951m x 555975m (50.0% of tile)
22:52:36.721 | INFO    | Task run 'download_modis_batch-6af' -   Read 2400x4800 pixels
22:52:36.736 | INFO    | Task run 'download_modis_batch-6af' -   Masked nodata value: -3000.0
22:52:37.491 | INFO    | Task run 'download_modis_batch-6af' -   âœ“ Processed successfully (0.2% valid pixels)
22:52:37.492 | INFO    | Task run 'download_modis_batch-6af' - 
Processing summary:
22:52:37.493 | INFO    | Task run 'download_modis_batch-6af' -   Total composites found: 15
22:52:37.493 | INFO    | Task run 'download_modis_batch-6af' -   Successfully processed: 14
22:52:37.493 | INFO    | Task run 'download_modis_batch-6af' -   Skipped (no overlap): 0
22:52:37.493 | INFO    | Task run 'download_modis_batch-6af' -   Failed: 1
22:52:38.455 | INFO    | Task run 'download_modis_batch-6af' - Writing to temp file (FUSE-safe): /tmp/ndvi_modis_1qs_2kx9/modis_ndvi_20240901_20240930.nc
22:52:40.177 | INFO    | Task run 'download_modis_batch-6af' - Copying to final location: /mnt/workwork/geoserver_data/raw/modis/modis_ndvi_20240901_20240930.nc
22:52:58.323 | INFO    | Task run 'download_modis_batch-6af' - âœ“ MODIS NDVI saved: /mnt/workwork/geoserver_data/raw/modis/modis_ndvi_20240901_20240930.nc
22:52:58.350 | INFO    | Task run 'download_modis_batch-6af' - Finished in state Completed()
22:53:48.771 | INFO    | Task run 'process_ndvi_to_geotiff-cce' - âœ“ Processed: 2024-09-29
22:54:37.606 | INFO    | Task run 'process_ndvi_to_geotiff-cce' - âœ“ Processed: 2024-09-29
22:55:25.181 | INFO    | Task run 'process_ndvi_to_geotiff-cce' - âœ“ Processed: 2024-09-29
22:56:13.117 | INFO    | Task run 'process_ndvi_to_geotiff-cce' - âœ“ Processed: 2024-09-29
22:57:01.453 | INFO    | Task run 'process_ndvi_to_geotiff-cce' - âœ“ Processed: 2024-09-29
22:57:48.919 | INFO    | Task run 'process_ndvi_to_geotiff-cce' - âœ“ Processed: 2024-09-29
22:58:36.080 | INFO    | Task run 'process_ndvi_to_geotiff-cce' - âœ“ Processed: 2024-09-29
22:59:23.834 | INFO    | Task run 'process_ndvi_to_geotiff-cce' - âœ“ Processed: 2024-09-29
23:00:11.850 | INFO    | Task run 'process_ndvi_to_geotiff-cce' - âœ“ Processed: 2024-09-29
23:00:59.674 | INFO    | Task run 'process_ndvi_to_geotiff-cce' - âœ“ Processed: 2024-09-29
23:01:47.351 | INFO    | Task run 'process_ndvi_to_geotiff-cce' - âœ“ Processed: 2024-09-29
23:02:34.577 | INFO    | Task run 'process_ndvi_to_geotiff-cce' - âœ“ Processed: 2024-09-29
23:03:21.825 | INFO    | Task run 'process_ndvi_to_geotiff-cce' - âœ“ Processed: 2024-09-29
23:04:10.080 | INFO    | Task run 'process_ndvi_to_geotiff-cce' - âœ“ Processed: 2024-09-29
23:04:10.082 | INFO    | Task run 'process_ndvi_to_geotiff-cce' - Finished in state Completed()
23:04:10.095 | INFO    | Task run 'append_to_yearly_historical_ndvi-012' - ðŸ“¦ Appending data from modis_ndvi_20240901_20240930.nc to yearly historical files
23:04:10.096 | INFO    | Task run 'append_to_yearly_historical_ndvi-012' -   Processing all dates in source file
23:04:10.101 | INFO    | Task run 'append_to_yearly_historical_ndvi-012' -   Processing 1 dates
23:04:10.101 | INFO    | Task run 'append_to_yearly_historical_ndvi-012' -   Dates span 1 year(s): [2024]
23:04:10.102 | INFO    | Task run 'append_to_yearly_historical_ndvi-012' - 
  ðŸ“… Processing year 2024 (1 dates)
23:04:10.102 | INFO    | Task run 'append_to_yearly_historical_ndvi-012' -     Creating new year file with 1 dates
23:04:10.103 | INFO    | Task run 'append_to_yearly_historical_ndvi-012' -     Writing to temp file...
23:04:47.931 | INFO    | Task run 'append_to_yearly_historical_ndvi-012' -     Copying to: /mnt/workwork/geoserver_data/ndvi_modis_hist/ndvi_modis_2024.nc
23:04:49.119 | INFO    | Task run 'append_to_yearly_historical_ndvi-012' -     âœ“ Updated ndvi_modis_2024.nc
23:04:49.120 | INFO    | Task run 'append_to_yearly_historical_ndvi-012' -       Time range: 2024-09-29 to 2024-09-29
23:04:49.120 | INFO    | Task run 'append_to_yearly_historical_ndvi-012' -       Total days: 14
23:04:49.121 | INFO    | Task run 'append_to_yearly_historical_ndvi-012' - 
âœ“ Updated 1 yearly file(s)
23:04:49.122 | INFO    | Task run 'append_to_yearly_historical_ndvi-012' - Finished in state Completed()
23:04:49.122 | INFO    | Flow run 'infrared-pronghorn' - âœ“ Updated 1 yearly historical file(s)
23:04:49.311 | INFO    | Task run 'cleanup_raw_files-b1f' - âœ“ Cleaned up: modis_ndvi_20240901_20240930.nc
23:04:49.313 | INFO    | Task run 'cleanup_raw_files-b1f' - Finished in state Completed()
23:04:49.313 | INFO    | Flow run 'infrared-pronghorn' - âœ“ Completed batch
23:04:51.066 | ERROR   | Flow run 'infrared-pronghorn' - Failed to refresh mosaic: type object 'DataSource' has no attribute 'NDVI'
23:04:51.066 | INFO    | Flow run 'infrared-pronghorn' - 
âœ“ Processed 14 files
23:04:51.084 | INFO    | Flow run 'infrared-pronghorn' - Finished in state Completed()
================================================================================
MODIS NDVI FLOW TEST
================================================================================

Test date range: 2024-09-01 to 2024-09-30
Expected: ~2 MODIS composites (16-day interval)

Starting MODIS flow...
================================================================================


================================================================================
âœ“ TEST PASSED!
================================================================================
Processed 14 GeoTIFF files

Yearly historical files created: 3
  2015: 17 composites
  ndvi_modis_2015.nc: Error - name 'pd' is not defined
  2018: 19 composites
  ndvi_modis_2018.nc: Error - name 'pd' is not defined
  2024: 14 composites
  ndvi_modis_2024.nc: Error - name 'pd' is not defined

You can now run the full download with:
  python app/run_ndvi.py
  # or in background:
  ./run_ndvi_background.sh
23:04:51.109 | INFO    | prefect - Stopping temporary server on http://127.0.0.1:8917
